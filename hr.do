set more offcapture log closeclearset scheme lean2/*insheet using "data\AllGrantRelatedBroadieData_anon.csv", names caselabel var EmployeeID "Unique identifier"label var WorkerStatus "Active, On Leave, Terminated"label var WorkerType "High level definition of person: Employee (paid by Broad) or Contingent (not paid by Broad)"label var WorkerSubType "More granular definition of person: Employee, Affiliate paid by Broad, Affiliate unpaid by Broad"label var EmployeeClassification "Most granular definition of person (includes flag for trainees, affiliates who are members of partner institutions, affiliations who are non-partner institution affiliated, etc)"label var MostRecentHireDate "Latest hire date to Broad (some affiliates are hired, leave and are re-hired so this reflects the last date they were hired)"label var PositionStartDate "Latest role start date (update triggered by promotion, role change, lateral move, etc)"label var OriginalPostdocStartDate "First start date at Broad if a trainee (postdoc)"label var PostdocStartDate "Latest start date at Broad if a trainee (postdoc)"label var InstituteScientist "New designation for staff scientists who are critical contributors to Broad scientific endeavors (these are all employees by definition)"label var JobProfile "Job title"label var BusinessTitle "Additional title if specified by person or supervisor"label var ProfessionalScientist "Staff scientist designation (includes research scientists, computational scientists, etc)"label var ManagementLevel "New designation for level of management (non-manager, manager, supervisor, associate director, director, etc)"label var Manager "Direct supervisor (may or may not be person who manages day-to-day activities)"label var SupervisoryOrganization "Manager's org unit"label var FTE "% of full time effort"label var TopLevelOrg "Top level of org chart"label var BroadGroup "Second level of org chart"label var Subgroup "Third and most granular level of org chart"label var AffiliateLocation "Affiliate's home institution"label var CompensationGrade "Wage grade (set in part by market analysis of salaries for specific job familes and roles)"label var TotalBasePayAmount "Annual salary"label var PayGroup "Code for Payroll (unlikely to be useful for our analyses)"label var EligibleforBenefits "All Broad paid employees and affiliates are eligible for benefits; unpaid affiliates are not "label var RaceEthnicity "This is self-reported or best guess by HR to comply with EEO requirements.  Should be present for all paid Broad employees and affiliates.  "label var TerminationDate "Date when last terminated"label var PrimaryTerminationReason "Most consistent field for reason for departure"label var SecondaryTerminationReasons "Additional field for reason for departure (less consistent)"label var CFTerminationEventVoluntaryorIn "Voluntary or involuntary termination flag"save data\HR, replaceuse data\HRsplit SupervisoryOr, p("(")drop SupervisoryOrg*2 SupervisoryOrg*3 SupervisoryOrganizationrename Supervisory SupervisoryOrganizationreplace SupervisoryOrganization=trim(SupervisoryOrganization)save data\HR, replace*/log using "logs\HR_$S_DATE", replace *BROADIE DATA*use data\HR/*d, fullnamestab WorkerStatus, missing tab WorkerType, missing tab WorkerSubType , missingtab EmployeeClassification , missingtab InstituteScientist , missingtab JobProfile , missingtab BusinessTitle , missingtab ProfessionalScientist , missingtab ManagementLevel , missingtab Manager , missingtab FTE , missingtab TopLevelOrg , missingtab BroadGroup , missingtab Subgroup , missingtab AffiliateLocation , missingtab CompensationGrade , missingtab PayGroup , missingtab EligibleforBenefits , missingtab SupervisoryOrganization, missing*/bysort BroadGroup: tab Subgroupbysort BroadGroup: tab SupervisoryOrbysort WorkerType: tab WorkerSubbysort WorkerType: tab EmployeeClassification/*g counter=1keep counter Subgroup *duplicates dropcollapse (sum) counter, by (Subgroup*)gsort counterg order=_ngraph bar counter, over(Subgroup, sort(order) label(angle(45) labsize(vsmall))) ytitle("Number of Employees in Subgroup") b1title("Subgroups") xsize(12)graph export "output\\tmp.png", replacepng2rtf using "output\\broadies_$S_DATE.doc", g(output\\tmp.png) replacegsort -counterkeep if _n<=25graph bar counter, over(Subgroup, sort(order) label(angle(45) labsize(vsmall))) ytitle("Number of Employees in Subgroup") b1title("Subgroups (Top 25)") xsize(7)graph export "output\\tmp.png", replacepng2rtf using "output\\broadies_$S_DATE.doc", g(output\\tmp.png) appendclearforeach var in BroadGroup SupervisoryOrganization {use data\HRg counter=1keep counter `var' *duplicates dropcollapse (sum) counter, by (`var')gsort counterg order=_ngraph bar counter, over(`var', sort(order) label(angle(45) labsize(vsmall))) ytitle("Number of Employees in `var'") b1title("`var'") xsize(12)graph export "output\\tmp.png", replacepng2rtf using "output\\broadies_$S_DATE.doc", g(output\\tmp.png) appendgsort -counterkeep if _n<=25graph bar counter, over(`var', sort(order)  label(angle(45) labsize(vsmall))) ytitle("Number of Employees in `var'") b1title("`var' (Top 25)") xsize(9)graph export "output\\tmp.png", replacepng2rtf using "output\\broadies_$S_DATE.doc", g(output\\tmp.png) appendclear}foreach var in WorkerType WorkerSub EmployeeClass {use data\broadie2g counter=1keep counter `var' *duplicates dropcollapse (sum) counter, by (`var')gsort counterg order=_ngraph bar counter, over(`var', sort(order) label(angle(45))) ytitle("Number of Employees in `var'") b1title("`var'") graph export "output\\tmp.png", replacepng2rtf using "output\\broadies_$S_DATE.doc", g(output\\tmp.png) appendclear}*/joinby EmployeeID using data\GRANT, unmatched(both)tab _m tab WorkerType if _m~=3, missingtab WorkerSubType if _m~=3, missingtab EmployeeClassification if _m~=3, missingtab Termination if _m~=3, missingtab Termination if _m~=3, missingbysort BroadGroup: tab GrantMbysort Subgroup: tab FundedProgLVL4save data\GRANT_HR, replace