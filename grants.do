set more offcapture log closeclear/*insheet using "data\Effort Distributions Calender 2016 - June 2017.csv", names caseg FullName=FirstName + " " + LastNameorder Employee FirstName LastName FullNamelog using "logs\codebook_broad_grants_$S_DATE.log", replacecodebook, all mv detail tabulate(10)log closesave data\grants, replace*/log using "logs\grants_$S_DATE", replaceuse data\grantscountcount if Salary==Effortg diff=Salary-Efforttab diff if Salary~=Effortegen group=group( Grant GrantMediumText Calendaryear Calendarmonth)sum group, detailg counter=1collapse (sum) counter, by (group Grant GrantMediumText Calendaryear Calendarmonth)sum countersum counter, detailsort Calendaryear Calendarmonth Grant*gsort -counterlist Grant* if _n==1clearuse data\grantstab Effortbysort EmployeeID Calendaryear Calendarm: egen sumEffort=sum(Effort)sum sumEffort, detailkeep if sumEffort~=100sort EmployeeID Calendar*drop if EmployeeID==EmployeeID[_n-1] & Calendary==Calendary[_n-1] & Calendarm==Calendarm[_n-1]counttab sumEffortclearuse data\grantstab Salarybysort EmployeeID Calendaryear Calendarm: egen sumSalary=sum(Salary)sum sumSalary, detailkeep if sumSalary~=100sort EmployeeID Calendar*drop if EmployeeID==EmployeeID[_n-1] & Calendary==Calendary[_n-1] & Calendarm==Calendarm[_n-1]counttab sumSalaryclearuse data\grantskeep Grant* EmployeeIDduplicates dropg counter=1collapse (sum) counter, by (EmployeeID)sum counter, detailtab countersort counter Elist EmployeeID counter if counter>=7clearuse data\grantsg counter=1collapse (sum) counter, by (Grant* Calendar*)rename Calendaryear yearrename Calendarm monthgen modate = ym(year, month) format modate %tm sort modateegen grantgroup=group(Grant GrantM)collapse (mean) counter, by (Grant GrantM)gsort counterlist GrantM if _n<=15sort counterg order = _ngraph bar counter, over(Grant, sort(order) label(nolabels)) ytitle("Average Number of People per Grant") b1title("Grants")graph save "output\\people_per_grant", replacedrop if counter>100graph bar counter, over(Grant, sort(order) label(nolabels)) ytitle("Average Number of People per Grant") b1title("Grants")graph save "output\\people_per_grant2", replaceclearuse data\grantsg counter=1collapse (sum) counter, by (EmployeeID Calendar*)rename Calendaryear yearrename Calendarm monthgen modate = ym(year, month) format modate %tm sort modatecollapse (mean) counter, by (EmployeeID)sort counterg order = _ngraph bar counter, over(EmployeeID, sort(order) label(nolabels)) ytitle("Average Number of Grants") b1title("Employees")graph save "output\\grant_per_person", replaceclearuse data\grantskeep GrantMedium FundedProgramTextduplicates dropg counter=1collapse (sum) counter, by (Grant)stopgraph bar counter, over(Country, sort(order) label(nolabels)) ytitle("Number of Tenants") xsize(9)graph save "output\\output\\tenants_cutoffa", replacegraph export "output\\tenants_cutoffa.png", replace