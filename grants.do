set more offcapture log closeclearset scheme lean2/*insheet using "data\Effort Distributions Calender 2016 - June 2017.csv", names caseg FullName=FirstName + " " + LastNameorder Employee FirstName LastName FullNamelog using "logs\codebook_broad_grants_$S_DATE.log", replacecodebook, all mv detail tabulate(10)log closedrop Full First Lastsave data\GRANT, replace*/log using "logs\grants_$S_DATE", replaceuse data\GRANTcountcount if Salary==Effortg diff=Salary-Efforttab diff if Salary~=Effortbysort FundedProgLVL3: tab FundedProgramTbysort FundedProgLVL4: tab FundedProgramTegen group=group( Grant GrantMediumText Calendaryear Calendarmonth)sum group, detailg counter=1collapse (sum) counter, by (group Grant GrantMediumText Calendaryear Calendarmonth)sum countersum counter, detailsort Calendaryear Calendarmonth Grant*gsort -counterlist Grant* if _n==1clearuse data\GRANTtab Effortbysort EmployeeID Calendaryear Calendarm: egen sumEffort=sum(Effort)sum sumEffort, detailkeep if sumEffort~=100sort EmployeeID Calendar*drop if EmployeeID==EmployeeID[_n-1] & Calendary==Calendary[_n-1] & Calendarm==Calendarm[_n-1]counttab sumEffortclearuse data\GRANTtab Salarybysort EmployeeID Calendaryear Calendarm: egen sumSalary=sum(Salary)sum sumSalary, detailkeep if sumSalary~=100sort EmployeeID Calendar*drop if EmployeeID==EmployeeID[_n-1] & Calendary==Calendary[_n-1] & Calendarm==Calendarm[_n-1]counttab sumSalaryclearuse data\GRANTkeep Grant* EmployeeIDduplicates dropg counter=1collapse (sum) counter, by (EmployeeID)sum counter, detailtab countersort counter Elist EmployeeID counter if counter>=7clear/*use data\GRANTg counter=1collapse (sum) counter, by (Grant* Calendar*)rename Calendaryear yearrename Calendarm monthgen modate = ym(year, month) format modate %tm sort modateegen grantgroup=group(Grant GrantM)collapse (mean) counter, by (Grant GrantM)gsort counterlist GrantM if _n<=15sort counterg order = _ngraph bar counter, over(Grant, sort(order) label(nolabels)) ytitle("Average Number of People per Grant" "January 2016 - July 2017") b1title("Each Grant")graph save "output\\people_per_grant", replacegraph export "output\\tmp.png", replace*png2rtf using "output\\broad_grant_$S_DATE.doc", g(output\\tmp.png) replace  sum counter, detailgsort -ordersort orderdrop if counter>100graph bar counter, over(Grant, sort(order) label(nolabels)) ytitle("Average Number of People per Grant" "January 2016 - July 2017") b1title("Each Grant")graph save "output\\people_per_grant2", replacegraph export "output\\tmp.png", replace*png2rtf using "output\\broad_grant_$S_DATE.doc", g(output\\tmp.png) appendsum counter, detailclear*/use data\GRANTg counter=1keep Grant* counter EmployeeID duplicates dropcollapse (sum) counter, by (Grant*)gsort counterg order=_ngraph bar counter, over(Grant, sort(order) label(nolabels)) ytitle("Number of Unique People per Grant" "January 2016 - July 2017") b1title("Each Grant")graph save "output\\unique_people_per_grant", replacegraph export "output\\tmp.png", replace*png2rtf using "output\\broad_grant_$S_DATE.doc", g(output\\tmp.png) appendsum counter, detailgsort -orderlist Grant* counter if _n<=15sort orderdrop if counter>100graph bar counter, over(Grant, sort(order) label(nolabels)) ytitle("Number of Unique People per Grant" "January 2016 - July 2017") b1title("Each Grant")graph save "output\\unique_people_per_grant2", replacegraph export "output\\tmp.png", replace*png2rtf using "output\\broad_grant_$S_DATE.doc", g(output\\tmp.png) appendsum counter, detailclear/**This uses a version of the dataset with the names still in ituse data\grantg counter=1collapse (sum) counter, by (EmployeeID FullName Calendar*)rename Calendaryear yearrename Calendarm monthgen modate = ym(year, month) format modate %tm sort modatecollapse (mean) counter, by (EmployeeID FullName )sort counterg order = _ngraph bar counter, over(EmployeeID, sort(order) label(nolabels)) ytitle("Average Number of Grants" "January 2016 - July 2017") b1title("Individual Employees")graph save "output\\grant_per_person", replacegraph export "output\\tmp.png", replace*png2rtf using "output\\broad_grant_$S_DATE.doc", g(output\\tmp.png) appendsum counter, detaillist FullName  if _n<=15gsort -orderclearuse data\GRANTkeep EmployeeID Grant* FullName duplicates dropg counter=1collapse (sum) counter, by (EmployeeID FullName )sort counterg order = _ngraph bar counter, over(EmployeeID, sort(order) label(nolabels)) ytitle("Number of Unique Grants" "January 2016 - July 2017") b1title("Individual Employees")graph save "output\\unique_grant_per_person", replacegraph export "output\\tmp.png", replace*png2rtf using "output\\broad_grant_$S_DATE.doc", g(output\\tmp.png) appendsum counter, detailgsort -orderlist FullName counter if _n<=15clear*/use data\GRANTkeep GrantMedium FundedProgramTextduplicates dropg counter=1collapse (sum) counter, by (Grant)sort counterg order = _ngraph bar counter, over(Grant, sort(order) label(nolabels)) ytitle("Number of Unique Programs per Grant" "January 2016 - July 2017") b1title("Each Grant")graph save "output\\unique_programs_per_grant", replacegraph export "output\\tmp.png", replace*png2rtf using "output\\broad_grant_$S_DATE.doc", g(output\\tmp.png) appendsum counter, detailgsort -orderlist Grant  counter if _n<=15clearuse data\GRANTkeep GrantMedium FundedProgramTextduplicates dropg counter=1collapse (sum) counter, by (Funded)sort counterg order = _ngraph bar counter, over(Funded, sort(order) label(nolabels)) ytitle("Number of Unique Grants per Detailed Program" "January 2016 - July 2017") b1title("Each Detailed Program")graph save "output\\unique_grants_per_program", replacegraph export "output\\tmp.png", replace*png2rtf using "output\\broad_grant_$S_DATE.doc", g(output\\tmp.png) appendsum counter, detailclearuse data\GRANTkeep GrantMedium FundedProgLVL3duplicates dropg counter=1collapse (sum) counter, by (Funded)sort counterg order = _ngraph bar counter, over(Funded, sort(order) label(angle(45) labsize(vsmall))) ytitle("Number of Unique Grants per Program" "Level 3, January 2016 - July 2017") b1title("Each Level 3 Program")graph save "output\\unique_grants_per_program_level3", replacegraph export "output\\tmp.png", replace*png2rtf using "output\\broad_grant_$S_DATE.doc", g(output\\tmp.png) appendsum counter, detailgsort -orderlist Funded counter if _n<=15clearuse data\GRANTkeep GrantMedium FundedProgLVL4duplicates dropg counter=1collapse (sum) counter, by (Funded)sort counterg order = _ngraph bar counter, over(Funded, sort(order) label(angle(45) labsize(tiny))) ytitle("Number of Unique Grants per Program" "Level 4, January 2016 - July 2017") b1title("Each Level 4 Program")graph save "output\\unique_grants_per_program_level4", replacegraph export "output\\tmp.png", replace*png2rtf using "output\\broad_grant_$S_DATE.doc", g(output\\tmp.png) appendsum counter, detailgsort -orderlist Funded counter if _n<=15clearerase  "output\\tmp.png"graph bar counter, over(Country, sort(order) label(nolabels)) ytitle("Number of Tenants") xsize(9)graph save "output\\output\\tenants_cutoffa", replacegraph export "output\\tenants_cutoffa.png", replace